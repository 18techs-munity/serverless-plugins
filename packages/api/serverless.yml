service:
  name: aws-nodejs-ecma-script

plugins:
  - serverless-webpack
  - serverless-offline-kinesis
  - serverless-offline-dynamodb-streams
  - serverless-offline

provider:
  name: aws
  runtime: nodejs8.10

functions:
  listPolls:
    handler: src/index.listPolls
    events:
      - http:
          method: get
          path: api/v1/polls
  createPoll:
    handler: src/index.createPoll
    events:
      - http:
          method: post
          path: api/v1/polls
  getPoll:
    handler: src/index.getPoll
    events:
      - http:
          method: get
          path: api/v1/polls/{id}
  updatePoll:
    handler: src/index.updatePoll
    events:
      - http:
          method: put
          path: api/v1/polls/{id}
  removePoll:
    handler: src/index.removePoll
    events:
      - http:
          method: delete
          path: api/v1/polls/{id}
  aggregate:
    namle: "aggregate"
    handler: src/index.aggregate
    events:
      - stream:
          type: kinesis
          arn: arn:aws:kinesis:eu-west-1:XXXXXX:stream/polls
          batchSize: 10
          # startingPosition: TRIM_HORIZON
          startingPosition: LATEST
  notify:
    namle: "notify"
    handler: src/index.notify
    events:
      - stream:
          type: dynamodb
          arn: arn:aws:dynamodb:eu-west-1:XXXXXX:table/polls/stream/2018-07-02T19:48:31.121
          tableName: polls
          batchSize: 10
          # startingPosition: TRIM_HORIZON
          startingPosition: LATEST

custom:
  serverless-offline:
    port: 4000
  serverless-offline-kinesis:
    apiVersion: '2013-12-02'
    endpoint: http://0.0.0.0:4567
    region: eu-west-1
    accessKeyId: root
    secretAccessKey: root
  serverless-offline-dynamodb-streams:
    apiVersion: '2013-12-02'
    endpoint: http://0.0.0.0:8000
    region: eu-west-1
    accessKeyId: root
    secretAccessKey: root
